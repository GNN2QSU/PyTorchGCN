## SLIC算法分割超像素原理及Python实现

超像素（SuperPixel），就是把原本多个像素点，组合成一个大的像素。
比如，原本的图片有二十多万个像素，用超像素处理之后，就只有几千个像素了。
后面做直方图等处理就会方便许多。经常作为图像处理的预处理步骤。

在超像素算法方面，SLIC Superpixels Compared to State-of-the-art Superpixel Methods 这篇论文非常经典。
论文中从算法效率，内存使用以及直观性比较了现有的几种超像素处理方法，并提出了一种更加实用，速度更快的算法——SLIC（simple linear iterative clustering），名字叫做简单的线性迭代聚类。
其实是从k-means算法演化的，算法复杂度是O(n)，只与图像的像素点数有关。

这个算法突破性的地方有二：

* 限制聚类时搜索的区域（2Sx2S），这样将k-means算法的复杂度降为常数。
整个算法的复杂度为线性。

* 计算距离时考虑LAB颜色和XY距离，5维。这样就把颜色和距离都考虑进去了。
通过M可以调整颜色和距离的比重，灵活性强，超像素更加规则。


### SLIC算法原理

整个算法的输入只有一个，即超像素的个数K。

图片原有N个像素，要分割成K个像素，那么每个像素的大小是`N/K`。
超像素之间的距离（即规则情况下超像素的边长）就是`S=sqrt(N/K)`。

我们的目标是使代价函数（cost function）最小。
具体到本算法中，就是每个像素到所属的中心点的距离之和最小。

* 首先，将K个超像素种子（也叫做聚类，即超像素的中心），均匀撒到图像的像素点上。

* 一次迭代的第一步，对每个超像素的中心，2S范围内的所有像素点，判断他们是否属于这个超像素。
这样之后，就缩短了像素点到超像素中心的距离。

* 一次迭代的第二步，对每个超像素，将它的超像素中心移动到这个超像素的中点上。
这样也缩短了像素点到超像素中心的距离。

一般来说，迭代10是聚类效果和计算成本折中的次数。


###  SLIC算法步骤

1. 撒种子。将K个超像素中心分布到图像的像素点上。

2. 微调种子的位置。以K为中心的3×3范围内，移动超像素中心到这9个点中梯度最小的点上。这样是为了避免超像素点落到噪点或者边界上。

3. 初始化数据。取一个数组label保存每一个像素点属于哪个超像素。dis数组保存像素点到它属于的那个超像素中心的距离。

4. 对每一个超像素中心x，它2S范围内的点：如果点到超像素中心x的距离（5维）小于这个点到它原来属于的超像素中心的距离，那么说明这个点属于超像素x。更新dis，更新label。

5. 对每一个超像素中心，重新计算它的位置。

6. 重复4 5 两步。


##

超像素概念是2003年Xiaofeng Ren提出和发展起来的图像分割技术，是指具有相似纹理、颜色、亮度等特征的相邻像素构成的有一定视觉意义的不规则像素块。它利用像素之间特征的相似性将像素分组,用少量的超像素代替大量的像素来表达图片特征,很大程度上降低了图像后处理的复杂度，所以通常作为分割算法的预处理步骤。

常见的超像素分割方法包括： Graph-based 、NCut 、Turbopixel 、 Quick-shift 、 Graph-cut a、Graph-cut b 以及 SLIC 。

其中，SLIC（simple linear iterativeclustering），即 简单线性迭代聚类 。
 它是2010年提出的一种思想简单、实现方便的算法，将彩色图像转化为CIELAB颜色空间和XY坐标下的5维特征向量，然后对5维特征向量构造距离度量标准，对图像像素进行局部聚类的过程。

SLIC主要优点如下：

* 生成的超像素如同细胞一般紧凑整齐，邻域特征比较容易表达。这样基于像素的方法可以比较容易的改造为基于超像素的方法。
* 不仅可以分割彩色图，也可以兼容分割灰度图。
* 需要设置的参数非常少，默认情况下只需要设置一个预分割的超像素的数量。
* 相比其他的超像素分割方法，SLIC在运行速度、生成超像素的紧凑度、轮廓保持方面都比较理想。


### Reference

* [SLIC算法分割超像素原理及Python实现](https://www.kawabangga.com/posts/1923)

* [slic-python-implementation](https://github.com/laixintao/slic-python-implementation)

* [图像处理: 超像素(superpixels)分割 SLIC算法](https://cloud.tencent.com/developer/article/1348843)

